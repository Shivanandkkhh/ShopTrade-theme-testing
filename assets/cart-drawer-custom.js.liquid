// let cartDrawer = document.querySelectorAll('.cart-container-custom');

// function hide() {
//     cartDrawer.forEach((e) => {
//         e.style.display = "none";
//         document.querySelector('body').style.overflow = "auto";
//     })
// };

// function show() {
//     cartDrawer.forEach((e) => {
//         e.style.display = "grid";
//         document.querySelector('body').style.overflow = "hidden";
//     })
// }


// async function updateCartItemCounts() {
//    let countItem = await fetch(window.Shopify.routes.root + 'cart.js');
//    let item = await countItem.json();
//    let  count = item.item_count 
//    console.log(count);
//     document.querySelectorAll("[data-cart]").forEach(  (el)=> {
//         el.textContent = count;
//     });
// }

// async function updateme() {
//     let res = await fetch('/?section_id=cart-drawer-custom');
//     let data = await res.text();
//     let html = document.createElement('div');
//     html.innerHTML = data

//     let newBoxd = html.querySelector('.cart-container-custom');
//     let oldBoxd = document.querySelector('.cart-container-custom');

//     oldBoxd.innerHTML = newBoxd.innerHTML;
//     addToCartEvent();
// }

// function addToCartEvent() {

//     let updateItem = document.querySelectorAll('.cart-drawer_quantity_selector button');
//     updateItem.forEach((button) => {
//         // Get line items
//         button.addEventListener('click', async function () {
//             let rootItem = button.parentElement.parentElement;
//             const key = rootItem.getAttribute('data-line-item-key');

//             // Get new quantity
//             let currentQuantity = Number(button.parentElement.querySelector('input').value);
//             let isUp = button.classList.contains('cart-drawer_quantity_selector_plus');

//             const newQuantity = isUp ? currentQuantity + 1 : currentQuantity - 1;

//             const respo = await fetch(window.Shopify.routes.root + 'cart/update.js', {
//                 method: 'POST',
//                 headers: {
//                     Accept: 'application/json',
//                     'Content-Type': 'application/json'
//                 },
//                 body: JSON.stringify({ updates: { [key]: newQuantity } }),
//             });

//             //update cart
//             updateme()

//         });

//     });
// }

// addToCartEvent();

// const subForm = document.querySelectorAll('form[action="/cart/add"]');

// subForm.forEach((form) => {
//     form.addEventListener('submit', async (e) => {
//         e.preventDefault();
//         await fetch(window.Shopify.routes.root + 'cart/add.js', {
//             method: 'POST',
//             body: new FormData(form),
//         });
//         await fetch(window.Shopify.routes.root + 'cart.js', {
//             method: 'POST',
//             body: new FormData(form),
//         });

//         await updateme();
//         show();
//         addToCartEvent();



//         updateCartItemCounts()

//         let closeButton = document.querySelectorAll("[data-close-button]");



//         closeButton.forEach((e) => {
//             e.addEventListener('click', () => {
//                 // console.log("closeButton",e);
//                 hide();
//             });
//         });

//     })
// });


const submitForm = document.querySelectorAll('form[action="/cart/add"]');
const cartItemsTotal = document.querySelectorAll('[data-cart]');
const cartDrawerBar = document.querySelector('.cart-container-custom');


async function updateCartItem() {
    let cartItem = await fetch(window.Shopify.routes.root + 'cart.js');
    let itemCount = await cartItem.json();
    let count = itemCount.item_count;
    cartItemsTotal.forEach((e) => {
        e.textContent = count;
    })
}
async function updateCart(){
    let cartDrawer =  await fetch('/?section=cart-drawer-custom');
    let  text  = await cartDrawer.text();
    let html = document.createElement('div');
    html.innerHTML = text;

    let oldBox = document.querySelector('.cart-container-custom');
    let newBox = html.querySelector('.cart-container-custom');
    oldBox.innerHTML = newBox.innerHTML;

    cartDrawerBar.style.display = 'grid';
}


submitForm.forEach((form) => {
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        await fetch(window.Shopify.routes.root + 'cart/add.js', {
            method: "POST",
            body: new FormData(form),
        });

        updateCartItem()
        updateCart();

        //

        // let quantityButton = document.querySelectorAll('.cart-drawer_quantity_selector button');

        // quantityButton.forEach((button) => { 
        //     button.addEventListener('click', async () => {
        //         let rootItem = button.parentElement.parentElement;
        //         const key = rootItem.getAttribute('data-line-item-key');
        //         console.log("key:", key);

        //     });
        // });

        let updateItem = document.querySelectorAll('.cart-drawer_quantity_selector button');
        updateItem.forEach((button) => {
            // Get line items
            button.addEventListener('click', async function () {
                let rootItem = button.parentElement.parentElement;
                const key = rootItem.getAttribute('data-line-item-key');
                console.log(key);

            });
        });
        // let updateQantity  = await   fetch(window.Shopify.routes.root + 'cart/update.js', {
        //         method: 'POST',
        //         headers: {
        //         'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({updates:[{[key] : 1 }]})
        //     }) 

            // console.log('updateQantity',updateQantity);
            // get the qantity

            //

    });
}); 



 